<link rel="stylesheet" href="../../bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" href="../../css/preview-image.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

<style>
    .input {
        background-color: #DFDFDF;
    }

    .form-control-file {
        width: 0.1px;
        height: 0.1px;
        opacity: 0;
        overflow: hidden;
        position: absolute;
        z-index: -1;
    }

    .btn-add-img {
        color: white;
        padding: 5px 20px;
        background-color: #FF000A;
        border-radius: 15px;
        margin-top: 15px;
    }
</style>

<div class="col" style="margin: auto; text-align: center;padding-top: 30px;">
    <h1>Thêm sản phẩm</h1>
</div>

<form action="/product/add-product" method="post" enctype="multipart/form-data">

    <div class="row">
        <div class="col-xl-6 p-5">
            <div class="form-group">
                <label for="name">Tên sản phẩm</label>
                <input type="text" class="form-control input" id="name" name="name"
                    placeholder="Tên sản phẩm" style="background-color: #DFDFDF">
            </div>
            <div class="form-group">
                <label for="export_price">Giá bán</label>
                <input type="number" class="form-control input" id="export_price" name="export_price"
                    placeholder="Giá sản phẩm">
            </div>
            <div class="form-group">
                <label for="impot_price">Giá nhập</label>
                <input type="number" class="form-control input" id="impot_price" name="impot_price"
                       placeholder="Giá sản phẩm">
            </div>
            <div class="form-group">
                <label for="sale">Khuyến mãi</label>
                <input type="number" class="form-control input" id="sale" name="sale"
                    placeholder="Khuyến mãi (%)">
            </div>
            <div class="form-group">
                <label for="id_category">Loại</label>
                <select class="custom-select mr-sm-2 input" id="id_category" name="id_category">
                    <option selected value="">Chọn...</option>
                </select>
            </div>
            <div class="form-group">
                <label for="id_style">Mùa</label>
                <select class="custom-select mr-sm-2 input" id="id_style" name="id_style">
                    <option selected value="">Chọn...</option>
                </select>
            </div>
        </div>
        <div class="col-xl-6 p-5">
            <div class="form-group">
                <label for="id_brand">Thương hiệu</label>
                <select class="custom-select mr-sm-2 input" id="id_brand" name="id_brand">
                    <option selected value="">Chọn...</option>
                </select>
            </div>
            <div class="form-group">
                <label for="description">Thông tin chi tiết</label>
                <textarea class="form-control input" id="description" rows="3" name="description"></textarea>
            </div>
            <div class="form-group field input pl-2 pb-2" style="border-radius: 5px;">
                <input type="file" accept="image/*" class="form-control-file" id="pictureProduct" name="pictureProduct"
                    multiple="true" onclick="removePreviewImage()">

                <label for="pictureProduct" class="btn-add-img">Thêm ảnh</label>
            </div>
            <div class="form-group">
                <label>Số lượng</label>

                <div class="row m-2 border pt-2 pb-2" style="background-color: #DFDFDF; border-radius: 5px;">
                    <div class="col-6" id="newElementKey">Size</div>
                    <div class="col-6" id="newElementValue">Số lượng nhập</div>
                </div>

                <div class="row ml-2">
                    <div id="dynamicCheck" style="width: 30px; height: 30px;">
                        <img src="../../image/add2.svg" width="100%" height="100%" onclick="add();">
                    </div>
                    <div id="dynamicCheck" style="width: 30px; height: 30px;">
                        <img src="../../image/remove.svg" width="100%" height="100%" onclick="remove();">
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div class="col p-5" style="margin: auto; text-align: center">
        <input type="submit" class="btn btn-primary" style="width: 300px;" />

    </div>
</form>

<script>
    var i = 0;
    function add() {
        i++;
        var txtNewInputKey = document.createElement('div');
        var txtNewInputValue = document.createElement('div');

        // Then add the content (a new input box) of the element.
        txtNewInputKey.innerHTML = "<input type='text' id='size" + i + "' name='size' style='margin-top: 10px; margin-bottom: 10px;width: 100%;'>";
        txtNewInputValue.innerHTML = "<input type='number' id='qnt" + i + "' name='qnt' style='margin-top: 10px; margin-bottom: 10px; width: 100%;'>";

        // Finally put it where it is supposed to appear.
        document.getElementById("newElementKey").appendChild(txtNewInputKey);
        document.getElementById("newElementValue").appendChild(txtNewInputValue);
    }

    function remove() {
        var keyInfoProduct = document.getElementById("size" + i);
        var ValueInfoProduct = document.getElementById("qnt" + i);

        keyInfoProduct.remove();
        ValueInfoProduct.remove();
        i--;
        if (i < 0) {
            i = 0;
        }
    }


    var imginput = document.getElementById("pictureProduct");
    function removePreviewImage() {
        var pip = document.getElementsByClassName("pip");
        var pipLength = pip.length;
        for (var i = 0; i < pipLength; i++) {
            pip[0].remove();
        }
    }
    $(document).ready(function () {
        if (window.File && window.FileList && window.FileReader) {
            $("#pictureProduct").on("change", function (e) {
                var files = e.target.files,
                    filesLength = files.length;
                for (var i = 0; i < filesLength; i++) {
                    var f = files[i]
                    if (!/\.(jpe?g|png|gif)$/i.test(f.name)) {
                        alert("Hãy chọn ảnh");
                        imginput.value = null;
                        return false;
                    }
                    var fileReader = new FileReader();
                    fileReader.onload = (function (e) {
                        var file = e.target;
                        if (imginput.value == "") {
                            $("");
                        } else {
                            $("<span class=\"pip\">" +
                                "<img class=\"imageThumb\" src=\"" + e.target.result + "\" title=\"" + file.name + "\"/>" +
                                "</span>").insertAfter("#pictureProduct");
                        }
                    });
                    fileReader.readAsDataURL(f);
                }
            });
        } else {
            alert("Your browser doesn't support to File API")
        }
    });

    const setBrand = async () => {
        const response = await fetch('https://ae-shop.herokuapp.com/product/brand');
        const myJson = await response.json(); //extract JSON from the http response
        myJson.map((item,i)=>{
            var optionElement = document.createElement("option");
            optionElement.value = item.id_brand;
            optionElement.text = item.brand_name;
            optionElement.selected = false;
            document.getElementById("id_brand").appendChild(optionElement);
        })
    }
    const setCategory = async () => {
        const response = await fetch('https://ae-shop.herokuapp.com/product/category');
        const myJson = await response.json(); //extract JSON from the http response
        myJson.map((item,i)=>{
            var optionElement = document.createElement("option");
            optionElement.value = item.id_category;
            optionElement.text = item.name_category;
            optionElement.selected = false;
            document.getElementById("id_category").appendChild(optionElement);
        })
    }
    const setStyle = async () => {
        const response = await fetch('https://ae-shop.herokuapp.com/product/style');
        const myJson = await response.json(); //extract JSON from the http response
        myJson.map((item,i)=>{
            var optionElement = document.createElement("option");
            optionElement.value = item.id_style;
            optionElement.text = item.style_name;
            optionElement.selected = false;
            document.getElementById("id_style").appendChild(optionElement);
        })
    }
    setBrand();
    setStyle();
    setCategory()
</script>
